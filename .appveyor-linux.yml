version: CI-{build}
image: Ubuntu2004
branches:
  only:
  - main
# If using 22.04, you'll want to run this before running apt update:
#   sudo cp /etc/apt/trusted.gpg /etc/apt/trusted.gpg.d
# Appveyor's 22.04 image emits a lot of warnings otherwise.
install:
- sh: >-
    sudo apt update -qq

    sudo apt install -qqy -o DPkg::Progress-Fancy=0 --no-install-recommends libsdl2-dev libssl-dev

    git submodule update --init --recursive
build_script:
- sh: make
test_script:
- sh: >-
    mkdir aptyrian

    mkdir aptyrian/apdata

    cp opentyrian aptyrian/aptyrian

    cp COPYING aptyrian/

    cp apdata/* aptyrian/apdata/

    7za a "aptyrian-Linux-Release.zip" "aptyrian"
artifacts:
- path: '*.zip'

